Description: 
When a SSR is used to 'update' an existing usersubscription and the fields User, CostCenter or Company subscription are altered. A duplicate and end old Usersubscription action is required. 
The SSR will call createUserSubscription providing the existing user subscription as 'template'. In the newly duplicated User subscription the changed values user/cost center/company subscription are set.
The start date will be as provided (when not provided will default to todays date).
(note: The old User subscription will get an end date just before the start date, as result of the workflow calling the updateUserSubscription utility). 

As extra action of the createUserSubscription utility, the CI-UserSubscription relations between active CI and the to be 'created'(template) user subscription are copied. So the newly created user subscription is related to the same active CI(s) as the old one was.

Note: this functionality was built earlier, but was removed from the function during QA/re-BLD. With the idea that it could be handled by BRs. And by calling EndUsersubscription / create usersubscription. That is not the case as the SSR/workflow can not take care of copying the CI-Usersubscription relation(s). So please restore to the origanal solution.

=========
FUNCTION DESCRIPTION:  createUserSubscription
Create a new UserSubscription

MANDATORY INPUT VARIABLES:
- CompanySubscription (Sys-ID)
- User (Sys-ID)

OPTIONAL INPUT VARIABLES:
- Start date (sys(now) as default)
- Cost Center (Sys-ID) (default empty)
- UserSubscription (Sys-ID)
 
FUNCTION DETAILS:
The function creates a 'service_subscribe_sys_user' record. The mandatory fields will be filled. (reference to 'service_subscribe_company')

The function sets the User subscription attributes that are provided (or sets the default values).
If the New record is active BRs on service_subscribe_sys_user table are triggered on update. 

When the optional UserSubscription is provide the function will use that as 'template'
to make a copy from and will also duplicate the active CI-UserSubscription relations. So the newly created UserSubscription can act as a full replacement of the provided UserSubscription.


OUTCOME:
The routine/function will return information on success or failure (when failure an informative text is provided in the log, that indicates the reason)
In case of an error no UserSubscription record is created


==========================Oude tekst============================
Description: 
When a SSR is used to 'update'an existing usersubscription and the fields User, CostCenter or Company subscription are altered. A duplicate and and old Usersubscription action is required. In the newly duplicated User subscription the changed values user/cost center/company subscription are set.
The start date will be as provided (when not provided will default to todays date.
The old User subscription will get an end date just before the start date. 

As extra action the CI-UserSubscription relations between active CI and the to be 'updated'user subscription are copied. So the newly created user subscription is related to the same active CI(s) as the old one was.

Note: this functionality was built earlier, but was removed from the function during QA/re-BLD. With the idea that it could be handled by BRs. And by calling EndUsersubscription / create usersubscription. That is not the case as the SSR/workflow can not take care of copying the CI-Usersubscription relation(s). So please restore to the origanal solution.

=========
FUNCTION DESCRIPTION: updateUserSubscription
Update a new UserSubscription

MANDATORY INPUT VARIABLES:
- UserSubscription (Sys-ID)

OPTIONAL INPUT VARIABLES:
- Start date (sys(now) as default)
- Cost Center (Sys-ID) (default same as for the provided UserSubscription)
- CompanySubscription (Sys-ID) (default same as for the provided UserSubscription)
- End date (false/true) (empty as default)
 
FUNCTION DETAILS:
The function updates a 'service_subscribe_sys_user' record. 
When End date is provided the other optional attributes needs to empty. (!)
When Cost Center and/or CompanySubscription are provided the given 'service_subscription_sys_user' record will be deplicated and given the provided values. Note: the original UserSubscription will get the EndData filled (Startdate minus one day(second)). For the newly created Usersubscription the mandatory fields will be filled. (reference to 'service_subscribe_company', 'User')

The function sets the User subscription attributes that are provided (or sets the default values).
If the New record is active BRs on service_subscribe_sys_user table are triggered on update. 
These checks are always done:
- Sys-IDs when provided reference existing records
- sys_user.Company and service_sys_user.u_company_subscription.core_company are the same
- (when provided:) CostCenter.Company and service_sys_user.u_company_subscription.core_company are the same

<<<<add text on how to handle CI-Usersubscription situations  >>>>
When a duplicate UserSubscription is made, there are actions required on the (optional) existing UserSub-CI relation. This to reflect the CI-Usersubscription for active CIs in the same way as for the original usersubscription.

OUTCOME:
The routine/function will return information on success or failure and when failure an informative text is provided that indicates the reason.
In case of an error no UserSubscription record is created
